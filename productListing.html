<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products - GreenLeaf Plants</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Redux CDN -->
  <script src="https://unpkg.com/redux@4.2.1/dist/redux.min.js"></script>
  <!-- Your app store (uses localStorage persistence) -->
  <script src="redux/store.js"></script>
</head>
<body class="products-page">
  <header>
    <h2>GreenLeaf Plants</h2>
    <nav>
      <a href="productListing.html">Products</a>
      <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
    </nav>
  </header>

  <main>
    <h3>Our Houseplants</h3>
    <div class="categories">
      <h4>Indoor Plants</h4>
      <div class="plant-grid" id="indoor"></div>

      <h4>Flowering Plants</h4>
      <div class="plant-grid" id="flowering"></div>

      <h4>Air-Purifying Plants</h4>
      <div class="plant-grid" id="airPurifying"></div>
    </div>
  </main>

  <footer>
    <p>Want to go back? <a href="index.html">Return to Landing Page</a></p>
  </footer>

  <script>
    // PRODUCTS DATA
    const plants = [
      { id: 1, name: "Monstera", price: 25, category: "indoor", img: "Monstera.jpg" },
      { id: 2, name: "Peace Lily", price: 30, category: "flowering", img: "Peace Lily.jpg" },
      { id: 3, name: "Snake Plant", price: 20, category: "airPurifying", img: "Snake Plant.jpg" },
      { id: 4, name: "Aloe Vera", price: 15, category: "indoor", img: "Aloe Vera.jpg" },
      { id: 5, name: "Orchid", price: 35, category: "flowering", img: "Orchid.jpg" },
      { id: 6, name: "Spider Plant", price: 18, category: "airPurifying", img: "Spider Plant.jpg" },
    ];

    // Helper: check if product is already in persisted store to disable button appropriately
    function isInCart(productId) {
      const state = store.getState();
      return state.cartItems.some(p => p.id === productId);
    }

    function renderPlants() {
      plants.forEach(plant => {
        const container = document.getElementById(plant.category);
        const div = document.createElement("div");
        div.className = "plant-card";
        div.innerHTML = `
          <img src="${plant.img}" alt="${plant.name}">
          <h5>${plant.name}</h5>
          <p>$${plant.price.toFixed(2)}</p>
          <button id="btn-${plant.id}">Add to Cart</button>
        `;
        container.appendChild(div);

        const btn = document.getElementById(`btn-${plant.id}`);
        // If item already in cart, disable
        if (isInCart(plant.id)) btn.disabled = true;

        btn.onclick = () => {
          // Dispatch action to the store
          store.dispatch({ type: "ADD_TO_CART", payload: plant });
          // update UI
          document.getElementById("cart-count").innerText = store.getState().cartItems.reduce((s, it) => s + it.quantity, 0);
          btn.disabled = true;
        };
      });
    }

    // Render on load
    renderPlants();

    // Ensure cart-count displays persisted count on load
    document.getElementById("cart-count").innerText = store.getState().cartItems.reduce((s, it) => s + it.quantity, 0);

    // Update cart-count if store updates while on this page
    store.subscribe(() => {
      document.getElementById("cart-count").innerText = store.getState().cartItems.reduce((s, it) => s + it.quantity, 0);
    });
  </script>
</body>
</html>
